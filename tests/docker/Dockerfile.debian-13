FROM debian:13

ENV DEBIAN_FRONTEND=noninteractive

# Install sudo and basic tools
RUN apt-get update && \
    apt-get install -y sudo curl wget git ca-certificates gnupg && \
    apt-get clean

# Create test user
RUN useradd -m -s /bin/bash testuser && \
    echo "testuser:testuser" | chpasswd && \
    usermod -aG sudo testuser && \
    echo "testuser ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers

# Copy script from project root
COPY ./scripts/prepare.sh /tmp/prepare.sh
RUN chmod +x /tmp/prepare.sh

# Run script (desktop is NOT installed by default)
RUN /tmp/prepare.sh -u=testuser

# Copy validation script
COPY ./tests/scripts/validate.sh /tmp/validate.sh
RUN chmod +x /tmp/validate.sh

# Set working directory
WORKDIR /home/testuser

# Default command
CMD ["/bin/bash"]
